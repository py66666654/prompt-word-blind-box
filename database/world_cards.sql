-- 世界卡扩展架构

-- 世界卡表
CREATE TABLE IF NOT EXISTS world_cards (
    id INT AUTO_INCREMENT PRIMARY KEY,
    prompt_id INT NOT NULL,
    world_name VARCHAR(100) NOT NULL,
    world_type ENUM('fantasy', 'scifi', 'historical', 'modern', 'cyberpunk', 'steampunk', 'postapocalyptic', 'mythology', 'other') NOT NULL,
    time_period TEXT NOT NULL, -- 时空背景
    geography TEXT NOT NULL, -- 地理环境
    culture TEXT NOT NULL, -- 文化特色
    technology TEXT, -- 科技水平
    systems TEXT NOT NULL, -- 社会和法则体系
    history TEXT, -- 历史脉络
    key_locations TEXT, -- 关键场景
    created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
    FOREIGN KEY (prompt_id) REFERENCES prompt_cards(id) ON DELETE CASCADE
);

-- 世界卡标签表
CREATE TABLE IF NOT EXISTS world_tags (
    id INT AUTO_INCREMENT PRIMARY KEY,
    name VARCHAR(50) NOT NULL,
    category VARCHAR(50), -- 标签分类
    UNIQUE (name)
);

-- 世界卡-标签关联表
CREATE TABLE IF NOT EXISTS world_card_tags (
    world_card_id INT NOT NULL,
    tag_id INT NOT NULL,
    PRIMARY KEY (world_card_id, tag_id),
    FOREIGN KEY (world_card_id) REFERENCES world_cards(id) ON DELETE CASCADE,
    FOREIGN KEY (tag_id) REFERENCES world_tags(id) ON DELETE CASCADE
);

-- 插入示例世界卡标签
INSERT INTO world_tags (name, category) VALUES
('和平', '状态'),
('冲突', '状态'),
('革命', '状态'),
('繁荣', '状态'),
('衰败', '状态'),
('魔法', '元素'),
('高科技', '元素'),
('低科技', '元素'),
('多元种族', '社会'),
('宗教主导', '社会'),
('科学主导', '社会'),
('贵族制', '政治'),
('民主制', '政治'),
('专制', '政治'),
('无政府', '政治'),
('朋克', '风格'),
('黑暗', '风格'),
('童话', '风格'),
('写实', '风格'),
('浪漫', '风格');

-- 插入示例世界卡数据
INSERT INTO prompt_cards (prompt_text, preview_url, category_id, type_id, quality_score, rarity_level_id, source, is_ai_generated) VALUES
('# 星锻帝国世界设定
## 基本信息
世界名称：星锻帝国 (Astral Forge Empire)
类型：太空歌剧+太空奇幻
时代：遥远未来，人类文明后宇宙时代

## 时空背景
公元5453年，人类文明已经扩张到银河系的多个星区，形成以星锻帝国为核心的多级政治体系。帝国以"星锻技术"—一种能够重塑行星环境和利用恒星能量的古老科技为立国之本。目前处于长达500年的"星锻和平"时期，但边境地区与神秘的异星文明"虚空织者"摩擦不断，帝国内部各大家族之间也暗流涌动。

## 地理环境
星锻帝国跨越银河系3个主要星区，包含约1000个宜居星球和数千个太空栖息地。帝国中心区"核心圈"由最早殖民的25个黄金行星组成，每个都经过星锻技术完美改造，资源丰富，环境优美。中层区"繁荣带"包含大多数工业和农业行星。外围区"边境领"是最新殖民地和资源开采区，环境恶劣，治安混乱。特殊区域"禁忌星带"则是被严格封锁的神秘区域，传闻与星锻技术起源有关。

## 文化特色
星锻帝国文化多元而复杂，核心是"星锻哲学"—相信人类有权利也有能力重塑宇宙以适应自身需求。帝国崇尚技术进步和人文修养并重，公民从小接受严格的双轨教育。核心圈贵族推崇古典艺术与礼仪，繁荣带中产阶级热衷科技创新和商业竞争，边境领拓荒者则发展出独特的生存主义亚文化。不同星球保留着源自地球不同文化的传统，但都融入了太空时代的元素。

## 科技水平
科技水平极高但发展不均。掌握星际航行、行星改造、人工智能、生命延长等高等科技。星锻技术是最尖端科技，能够引导恒星能量改变行星性质，但完整知识被垄断在少数家族手中。值得注意的是，帝国科技呈现古典与未来的混合风格，精密机械与量子计算并存，机器人与人类工匠共同工作。某些边缘科技，如心灵感应增强装置，处于伦理争议地带。

## 社会和法则体系
政治体系是君主立宪制与贵族联邦的混合体。皇帝拥有最高权威，但实际权力由八大星锻家族组成的枢密院和民选的星球代表组成的议会共同掌握。公民分为核心公民、普通公民和契约公民三个等级，权利和义务不同。法律体系由帝国基本法与各星球地方法相结合，辅以人工智能司法系统保证公正。帝国军团负责防卫和太空巡航，而各行星警备队负责本地治安。家族势力、跨星系贸易公司和宗教组织在政治舞台上扮演着重要角色。

## 历史脉络
帝国历史可追溯至人类离开母星地球的大迁徙时期。关键事件包括：
- 第一纪元(2200-3000)：人类初次殖民太阳系外行星，经历严酷的适应期
- 星锻发现纪元(3001-3500)：在废弃的外星遗迹中发现星锻技术，引发政治和科技革命
- 扩张纪元(3501-4500)：人类快速扩张到银河系多个星区，与多个外星种族首次接触
- 五王战争(4501-4953)：五个最强大的星锻家族争夺帝国控制权，造成大范围星际战争
- 统一纪元(4954-现在)：在现任皇帝星锻者奥古斯都领导下建立统一帝国，开始长期和平

## 关键场所
- 帝国首都星球"新雅典"：帝国政治、文化中心，建筑融合古典与未来风格
- 星锻学院：培养星锻技术操作者的神秘学府，位于重力异常的格莱沃斯行星
- 机械教大教堂：最大的技术崇拜组织中心，一个围绕恒星建造的巨型空间结构
- 边境星站阿尔忒弥斯：帝国与外星文明交界的军事前哨，暗藏多方势力
- 禁忌星带中心的黑暗星球：传说中星锻技术的起源地，被严密封锁

## 当前冲突
- 帝国与神秘的"虚空织者"外星文明在边境的冷战状态
- 八大星锻家族之间围绕皇位继承的暗中角力
- 星锻技术滥用导致的生态危机和道德争议
- 边境领拓荒者与中心政权的自治矛盾
- "技术平等"地下组织试图打破星锻技术垄断', 'https://placehold.co/600x400/4a6bdf/ffffff?text=星锻帝国世界设定预览', 4, 7, 88, 4, '科幻世界创作集', FALSE);

-- 获取最后插入的提示词ID
SET @last_prompt_id = LAST_INSERT_ID();

-- 插入对应的世界卡详细信息
INSERT INTO world_cards 
(prompt_id, world_name, world_type, time_period, geography, culture, technology, systems, history, key_locations) 
VALUES 
(@last_prompt_id, '星锻帝国', 'scifi', 
'公元5453年，人类文明已经扩张到银河系的多个星区，形成以星锻帝国为核心的多级政治体系。帝国以"星锻技术"—一种能够重塑行星环境和利用恒星能量的古老科技为立国之本。目前处于长达500年的"星锻和平"时期，但边境地区与神秘的异星文明"虚空织者"摩擦不断，帝国内部各大家族之间也暗流涌动。',
'星锻帝国跨越银河系3个主要星区，包含约1000个宜居星球和数千个太空栖息地。帝国中心区"核心圈"由最早殖民的25个黄金行星组成，每个都经过星锻技术完美改造，资源丰富，环境优美。中层区"繁荣带"包含大多数工业和农业行星。外围区"边境领"是最新殖民地和资源开采区，环境恶劣，治安混乱。特殊区域"禁忌星带"则是被严格封锁的神秘区域，传闻与星锻技术起源有关。',
'星锻帝国文化多元而复杂，核心是"星锻哲学"—相信人类有权利也有能力重塑宇宙以适应自身需求。帝国崇尚技术进步和人文修养并重，公民从小接受严格的双轨教育。核心圈贵族推崇古典艺术与礼仪，繁荣带中产阶级热衷科技创新和商业竞争，边境领拓荒者则发展出独特的生存主义亚文化。不同星球保留着源自地球不同文化的传统，但都融入了太空时代的元素。',
'科技水平极高但发展不均。掌握星际航行、行星改造、人工智能、生命延长等高等科技。星锻技术是最尖端科技，能够引导恒星能量改变行星性质，但完整知识被垄断在少数家族手中。值得注意的是，帝国科技呈现古典与未来的混合风格，精密机械与量子计算并存，机器人与人类工匠共同工作。某些边缘科技，如心灵感应增强装置，处于伦理争议地带。',
'政治体系是君主立宪制与贵族联邦的混合体。皇帝拥有最高权威，但实际权力由八大星锻家族组成的枢密院和民选的星球代表组成的议会共同掌握。公民分为核心公民、普通公民和契约公民三个等级，权利和义务不同。法律体系由帝国基本法与各星球地方法相结合，辅以人工智能司法系统保证公正。帝国军团负责防卫和太空巡航，而各行星警备队负责本地治安。家族势力、跨星系贸易公司和宗教组织在政治舞台上扮演着重要角色。',
'帝国历史可追溯至人类离开母星地球的大迁徙时期。关键事件包括：第一纪元(2200-3000)：人类初次殖民太阳系外行星，经历严酷的适应期。星锻发现纪元(3001-3500)：在废弃的外星遗迹中发现星锻技术，引发政治和科技革命。扩张纪元(3501-4500)：人类快速扩张到银河系多个星区，与多个外星种族首次接触。五王战争(4501-4953)：五个最强大的星锻家族争夺帝国控制权，造成大范围星际战争。统一纪元(4954-现在)：在现任皇帝星锻者奥古斯都领导下建立统一帝国，开始长期和平。',
'帝国首都星球"新雅典"：帝国政治、文化中心，建筑融合古典与未来风格。星锻学院：培养星锻技术操作者的神秘学府，位于重力异常的格莱沃斯行星。机械教大教堂：最大的技术崇拜组织中心，一个围绕恒星建造的巨型空间结构。边境星站阿尔忒弥斯：帝国与外星文明交界的军事前哨，暗藏多方势力。禁忌星带中心的黑暗星球：传说中星锻技术的起源地，被严密封锁。');

-- 获取最后插入的世界卡ID
SET @last_world_id = LAST_INSERT_ID();

-- 添加世界卡标签关联
INSERT INTO world_card_tags (world_card_id, tag_id) 
SELECT @last_world_id, id FROM world_tags WHERE name IN ('冲突', '高科技', '贵族制', '多元种族');

-- 再插入一个示例世界卡
INSERT INTO prompt_cards (prompt_text, preview_url, category_id, type_id, quality_score, rarity_level_id, source, is_ai_generated) VALUES
('# 迷雾大陆世界设定
## 基本信息
世界名称：迷雾大陆 (Mistlands)
类型：黑暗奇幻
时代：类中世纪，第三纪元末期

## 时空背景
迷雾大陆处于第三纪元的尾声，被称为"长夜时代"的黑暗期已持续近百年。太阳变得黯淡，天空常年被厚重的灰云和迷雾笼罩，导致昼短夜长，植物生长困难。大陆正在经历一场漫长的气候与魔法双重危机，各国在资源稀缺下争端不断。古老预言提及"最后的光明之子"将终结长夜，但民众对此信心日渐消退。当前时代魔法与知识都在衰退，迷信和恐惧在蔓延。

## 地理环境
迷雾大陆是一片被魔法屏障包围的超大型大陆，外界无法进入，内部也难以离开。地形多样，包括：
- 北部的永冻荒原：常年被冰雪覆盖，是冰系魔法生物的栖息地
- 中部的迷雾森林：浓雾弥漫的神秘森林，传说中精灵的最后避难所
- 西部的黯影山脉：多火山和温泉，也是地下城系统和矮人王国所在
- 东部的灰海岸：有古老港口城市，但近年来被不断上涨的灰色海水侵蚀
- 中央的辉光平原：仅存的大型农业区，各国为此争夺不休
- 南部的灼烁沙漠：近年来异常扩张的沙漠，据说埋葬着远古文明遗迹

大陆被七条魔法河流分割，每条河流具有不同特性和力量。

## 文化特色
迷雾大陆文明多元，主要包括：
- 辉光王国：人类最大政权，中央集权贵族制度，崇尚骑士精神和秩序
- 影林精灵：古老精灵族群，与自然共生，掌握植物和治愈魔法
- 黯影矮人：居住在山脉地下的工匠民族，精于锻造和机械
- 迷雾游牧部落：游走在危险地带的人类部落，信奉自然与混沌之力
- 灰港商业联盟：东部港口城市组成的商业同盟，科技发展较为先进

文化核心是"平衡哲学"，认为光明与黑暗、秩序与混沌需要维持平衡，当前黑暗占优被视为世界失衡的结果。各地都有"护光者"组织，致力于保存知识和寻找终结长夜的方法。艺术上，悲歌和暗色调绘画盛行，反映当前时代的忧郁。

## 魔法与科技
魔法在迷雾大陆已存在数千年，但正在神秘衰退。现存魔法体系包括：
- 秩序魔法：基于严格仪式和法则，主要由辉光王国术士学院传承
- 自然魔法：源于与自然力量的沟通，多为精灵和游牧部落所用
- 血脉魔法：通过古老血脉传承的天赋能力，正变得越来越罕见
- 禁忌魔法：利用黑暗与混沌之力，被大多数社会禁止但暗中流传

科技方面，处于中世纪晚期水平，但灰港联盟已开始发展蒸汽技术，黯影矮人掌握复杂的机械技术。魔法与技术的结合产物"奥术机械"开始出现，但仍属稀有。

## 社会和法则体系
大陆没有统一政权，分为多个王国、城邦和部落。最强大的是中部的辉光王国，实行封建制度，权力分散在国王和各大贵族家族之间。灰港联盟采用寡头商业共和制，由富商议会管理。黯影矮人实行氏族长老制，精灵则有松散的自然议会。

不同地区法律差异大，但普遍遵循一些共同原则，如魔法使用的规范和禁忌。各地都有骑士团、守夜人或护光者等组织维持秩序和抵御危险。职业行会在城市中具有重要影响力，尤其是法师协会和工匠行会。

货币系统多样，但黯影矮人铸造的"暗银币"被广泛接受。资源紧缺导致物资(尤其是食物和魔法材料)比金银更有价值。

## 历史脉络
迷雾大陆的历史被划分为三个主要纪元：
- 第一纪元(创世纪)：诸神创造世界，赐予凡人魔法，建立原初平衡
- 第二纪元(辉煌纪)：第一魔法文明兴起，创造许多奇迹，但最终因魔法战争毁灭
- 第三纪元(重建纪)：从废墟中重建的新文明，初期繁荣但近百年来陷入长夜危机

当前危机的起因众说纷纭：有人认为是古代咒语出错，有人相信是众神的惩罚，也有传言称某种"世界之外的存在"正在吞噬大陆的魔法与生命。

## 关键场所
- 辉光城：人类最大城市，辉光王国首都，拥有著名的术士学院
- 常青树：影林精灵的神圣之树，据说与整个大陆的生态系统相连
- 黯炉：黯影矮人的地下主城，有能与众神时代媲美的锻造技术
- 灰港：最大的港口城市，商业中心，新技术的发源地
- 迷雾之心：大陆中央的神秘区域，被永久迷雾笼罩，据说藏有终结长夜的秘密
- 七河交汇：七条魔法河流的交汇处，魔法能量异常集中的地方

## 当前冲突
- 长夜危机：气候恶化，农业减产，魔法衰退，引发各类次生危机
- 王国内战：辉光王国国王去世，王室血脉可能断绝，贵族间争夺王位
- 边境冲突：资源紧缺导致各政权间的边境摩擦和小规模战争
- 古代遗迹出现：长夜中一些被遗忘的远古遗迹开始显现，引发探索热潮
- 黑暗崛起：神秘邪教"永夜信徒"崛起，认为应拥抱而非抵抗长夜', 'https://placehold.co/600x400/4a6bdf/ffffff?text=迷雾大陆世界设定预览', 4, 7, 92, 4, '奇幻世界创作集', FALSE);

-- 获取最后插入的提示词ID
SET @last_prompt_id = LAST_INSERT_ID();

-- 插入对应的世界卡详细信息
INSERT INTO world_cards 
(prompt_id, world_name, world_type, time_period, geography, culture, technology, systems, history, key_locations) 
VALUES 
(@last_prompt_id, '迷雾大陆', 'fantasy', 
'迷雾大陆处于第三纪元的尾声，被称为"长夜时代"的黑暗期已持续近百年。太阳变得黯淡，天空常年被厚重的灰云和迷雾笼罩，导致昼短夜长，植物生长困难。大陆正在经历一场漫长的气候与魔法双重危机，各国在资源稀缺下争端不断。古老预言提及"最后的光明之子"将终结长夜，但民众对此信心日渐消退。当前时代魔法与知识都在衰退，迷信和恐惧在蔓延。',
'迷雾大陆是一片被魔法屏障包围的超大型大陆，外界无法进入，内部也难以离开。地形多样，包括：北部的永冻荒原：常年被冰雪覆盖，是冰系魔法生物的栖息地。中部的迷雾森林：浓雾弥漫的神秘森林，传说中精灵的最后避难所。西部的黯影山脉：多火山和温泉，也是地下城系统和矮人王国所在。东部的灰海岸：有古老港口城市，但近年来被不断上涨的灰色海水侵蚀。中央的辉光平原：仅存的大型农业区，各国为此争夺不休。南部的灼烁沙漠：近年来异常扩张的沙漠，据说埋葬着远古文明遗迹。大陆被七条魔法河流分割，每条河流具有不同特性和力量。',
'迷雾大陆文明多元，主要包括：辉光王国：人类最大政权，中央集权贵族制度，崇尚骑士精神和秩序。影林精灵：古老精灵族群，与自然共生，掌握植物和治愈魔法。黯影矮人：居住在山脉地下的工匠民族，精于锻造和机械。迷雾游牧部落：游走在危险地带的人类部落，信奉自然与混沌之力。灰港商业联盟：东部港口城市组成的商业同盟，科技发展较为先进。文化核心是"平衡哲学"，认为光明与黑暗、秩序与混沌需要维持平衡，当前黑暗占优被视为世界失衡的结果。各地都有"护光者"组织，致力于保存知识和寻找终结长夜的方法。艺术上，悲歌和暗色调绘画盛行，反映当前时代的忧郁。',
'魔法在迷雾大陆已存在数千年，但正在神秘衰退。现存魔法体系包括：秩序魔法：基于严格仪式和法则，主要由辉光王国术士学院传承。自然魔法：源于与自然力量的沟通，多为精灵和游牧部落所用。血脉魔法：通过古老血脉传承的天赋能力，正变得越来越罕见。禁忌魔法：利用黑暗与混沌之力，被大多数社会禁止但暗中流传。科技方面，处于中世纪晚期水平，但灰港联盟已开始发展蒸汽技术，黯影矮人掌握复杂的机械技术。魔法与技术的结合产物"奥术机械"开始出现，但仍属稀有。',
'大陆没有统一政权，分为多个王国、城邦和部落。最强大的是中部的辉光王国，实行封建制度，权力分散在国王和各大贵族家族之间。灰港联盟采用寡头商业共和制，由富商议会管理。黯影矮人实行氏族长老制，精灵则有松散的自然议会。不同地区法律差异大，但普遍遵循一些共同原则，如魔法使用的规范和禁忌。各地都有骑士团、守夜人或护光者等组织维持秩序和抵御危险。职业行会在城市中具有重要影响力，尤其是法师协会和工匠行会。货币系统多样，但黯影矮人铸造的"暗银币"被广泛接受。资源紧缺导致物资(尤其是食物和魔法材料)比金银更有价值。',
'迷雾大陆的历史被划分为三个主要纪元：第一纪元(创世纪)：诸神创造世界，赐予凡人魔法，建立原初平衡。第二纪元(辉煌纪)：第一魔法文明兴起，创造许多奇迹，但最终因魔法战争毁灭。第三纪元(重建纪)：从废墟中重建的新文明，初期繁荣但近百年来陷入长夜危机。当前危机的起因众说纷纭：有人认为是古代咒语出错，有人相信是众神的惩罚，也有传言称某种"世界之外的存在"正在吞噬大陆的魔法与生命。',
'辉光城：人类最大城市，辉光王国首都，拥有著名的术士学院。常青树：影林精灵的神圣之树，据说与整个大陆的生态系统相连。黯炉：黯影矮人的地下主城，有能与众神时代媲美的锻造技术。灰港：最大的港口城市，商业中心，新技术的发源地。迷雾之心：大陆中央的神秘区域，被永久迷雾笼罩，据说藏有终结长夜的秘密。七河交汇：七条魔法河流的交汇处，魔法能量异常集中的地方。');

-- 获取最后插入的世界卡ID
SET @last_world_id = LAST_INSERT_ID();

-- 添加世界卡标签关联
INSERT INTO world_card_tags (world_card_id, tag_id) 
SELECT @last_world_id, id FROM world_tags WHERE name IN ('冲突', '魔法', '黑暗', '多元种族', '贵族制');